<Project>

	<Target Name="GenerateVildmarkFonts" BeforeTargets="BeforeBuild" Condition=" '@(VildmarkFont)' != '' ">

		<PropertyGroup>
			<InputFontFile>%(VildmarkFont.FullPath)</InputFontFile>
			<InputFontRelativeDir>%(VildmarkFont.RelativeDir)</InputFontRelativeDir>
			<InputFontName>%(VildmarkFont.Filename)</InputFontName>
			<IntermediateFontOutputPath>$(IntermediateOutputPath)Vildmark\Font\</IntermediateFontOutputPath>
			<MsdfAtlasGenToolPath>$(MSBuildThisFileDirectory)..\tools\win-x64\msdf-atlas-gen.exe</MsdfAtlasGenToolPath>
			<CharSetFile>$(MSBuildThisFileDirectory)..\tools\win-x64\charset.txt</CharSetFile>
			<ImageOutputFile>$(IntermediateFontOutputPath)atlas.png</ImageOutputFile>
			<JsonOutputFile>$(IntermediateFontOutputPath)atlas.json</JsonOutputFile>
			<OutputImageResourceName>$(AssemblyName).$(InputFontRelativeDir.Replace("\", "."))$(InputFontName).png</OutputImageResourceName>
			<OutputJsonResourceName>$(AssemblyName).$(InputFontRelativeDir.Replace("\", "."))$(InputFontName).json</OutputJsonResourceName>
		</PropertyGroup>

		<RemoveDir Directories="$(IntermediateFontOutputPath)"></RemoveDir>
		<MakeDir Directories="$(IntermediateFontOutputPath)"></MakeDir>

		<Exec Command="$(MsdfAtlasGenToolPath) -font &quot;$(InputFontFile)&quot; -charset &quot;$(CharSetFile)&quot; -imageout &quot;$(ImageOutputFile)&quot; -json &quot;$(JsonOutputFile)&quot; -size 64 -yorigin top"></Exec>

		<ItemGroup>
			<EmbeddedResource Include="$(ImageOutputFile)">
				<LogicalName>$(OutputImageResourceName)</LogicalName>
			</EmbeddedResource>
			<EmbeddedResource Include="$(JsonOutputFile)">
				<LogicalName>$(OutputJsonResourceName)</LogicalName>
			</EmbeddedResource>
		</ItemGroup>
		
	</Target>

</Project>
