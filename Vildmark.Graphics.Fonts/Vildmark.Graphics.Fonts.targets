<Project>

    <PropertyGroup>
        <GeneratedFontsRootDirectory>$(IntermediateOutputPath)GeneratedFonts\</GeneratedFontsRootDirectory>
        <FontGeneratorExecutable Condition="$([MSBuild]::IsOSPlatform('Linux'))">.\tools\linux\fontbm</FontGeneratorExecutable>
        <FontGeneratorExecutable Condition="$([MSBuild]::IsOSPlatform('Windows'))">.\tools\windows\fontbm.exe</FontGeneratorExecutable>
    </PropertyGroup>
    
    <Target Name="GenerateFonts" BeforeTargets="BeforeBuild">
    
        <PropertyGroup>
            <GeneratedFontDirectory>$(GeneratedFontsRootDirectory)%(Font.RelativeDir)\</GeneratedFontDirectory>
            <GeneratedFontFilename>$(GeneratedFontDirectory)%(Font.Filename)</GeneratedFontFilename>
        </PropertyGroup>
        
        <MakeDir Directories="$(GeneratedFontDirectory)"></MakeDir>
        <Exec Command="$(FontGeneratorExecutable) --font-file %(Font.Identity) --output $(GeneratedFontFilename) --chars 0-255"></Exec>
        
    </Target>

    <ItemGroup>
        <EmbeddedResource Include="$(GeneratedFontsRootDirectory)**\*">
            <LogicalName>$([System.String]::Copy('%(RelativeDir)%(Filename)%(Extension)').Replace('$(GeneratedFontsRootDirectory)', '').Replace('\', '.'))</LogicalName>
        </EmbeddedResource>
    </ItemGroup>

</Project>
